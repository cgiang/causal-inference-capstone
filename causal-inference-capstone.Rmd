---
title: "What is the causal effect of sleeping time on life satisfaction?"
author: "Charlotte Giang, Yunyang Zhong"
date: "10/11/2020"
output: html_document
---

```{r,eval=TRUE}
library(ipumsr)
ddi <- read_ipums_ddi("atus_00001.xml")
data <- read_ipums_micro(ddi)
library(dplyr) 
data <- select(data, WT06, SPOUSEPRES, SPEDUC, SPEMPSTAT, Sleeping_time, Traveling, FAMINCOME, WB_RESP, WBLADDER, WBELIGTIME, caring_HH_adults)
data <- data %>%
  filter(!is.na(WBLADDER)) %>%
  filter(WBLADDER!=999)
```

```{r}
summary(data)
```

![](dag2.png)

Adjustment, total effect: Family income, Spouse or unmarried partner in household
Adjustment, direct effect: Family income, Person weight, Spouse or unmarried partner in household, Well-being

```{r, echo=FALSE, message=FALSE}
library(dagitty)
dag <- dagitty("dag {
bb=\"0,0,1,1\"
\"Employment status (spouse or partner)\" [pos=\"-0.4,0.3\"]
\"Family income\" [pos=\"-0.307,0.522\"]
\"Highest level of school completed (spouse or partner)\" [pos=\"-0.122,0.392\"]
\"Household elderly care\" [pos=\"0.137,0.841\"]
\"Life satisfaction\" [outcome,pos=\"-0.112,1.103\"]
\"Person weight\" [pos=\"-1.014,0.756\"]
\"Spouse or unmarried partner in household\" [pos=\"-0.801,0.599\"]
\"Traveling time\" [pos=\"-0.001,0.596\"]
\"Well-being\" [pos=\"-0.584,1.012\"]
\"Sleeping_time\" [exposure,pos=\"-1.108,1.101\"]
\"Employment status (spouse or partner)\" -> \"Family income\"
\"Family income\" -> \"Household elderly care\"
\"Family income\" -> \"Life satisfaction\"
\"Family income\" -> \"Traveling time\"
\"Family income\" -> \"Sleeping_time\"
\"Highest level of school completed (spouse or partner)\" -> \"Employment status (spouse or partner)\"
\"Highest level of school completed (spouse or partner)\" -> \"Family income\"
\"Household elderly care\" -> \"Life satisfaction\"
\"Household elderly care\" -> \"Traveling time\"
\"Person weight\" -> \"Life satisfaction\"
\"Person weight\" -> \"Well-being\"
\"Spouse or unmarried partner in household\" -> \"Employment status (spouse or partner)\"
\"Spouse or unmarried partner in household\" -> \"Family income\"
\"Spouse or unmarried partner in household\" -> \"Household elderly care\"
\"Spouse or unmarried partner in household\" -> \"Life satisfaction\"
\"Spouse or unmarried partner in household\" -> \"Traveling time\"
\"Spouse or unmarried partner in household\" -> \"Sleeping_time\"
\"Traveling time\" -> \"Life satisfaction\"
\"Well-being\" -> \"Life satisfaction\"
\"Sleeping_time\" -> \"Life satisfaction\"
\"Sleeping_time\" -> \"Person weight\"
\"Sleeping_time\" -> \"Well-being\"
}
")
plot(dag)
```

```{r}
library(ggplot2)
ggplot(data=data,aes(x=Sleeping_time,y=WBLADDER))+geom_point()+geom_smooth()


mod1 <- lm(WBLADDER~Sleeping_time, data = data)
summary(mod1)
```

```{r}
ggplot(data=data,aes(x=Sleeping_time,y=WBLADDER,color=factor(SPOUSEPRES)))+geom_point()+geom_smooth()

mod2 <- lm(WBLADDER~Sleeping_time+SPOUSEPRES, data = data)
summary(mod2)
```

```{r}
mod3 <- lm(WBLADDER~Sleeping_time+SPOUSEPRES+WT06, data = data)
summary(mod3)

mod4 <- lm(WBLADDER~WT06, data = data)
summary(mod4)
```

```{r}
library(splines)
ggplot(data, aes(y = SPOUSEPRES, x = Sleeping_time)) +
    geom_point() +
    geom_smooth(se = FALSE, color = "blue") +
    geom_smooth(formula = y~ns(x,2), method = "glm",
        method.args = list(family="binomial"),
        se = FALSE, color = "red"
    )

ggplot(data, aes(y = WT06, x = Sleeping_time)) +
    geom_point() +
    geom_smooth(se = FALSE, color = "blue") +
    geom_smooth(formula = y~ns(x,2), method = "glm",
        method.args = list(family="binomial"),
        se = FALSE, color = "red"
    )
```

